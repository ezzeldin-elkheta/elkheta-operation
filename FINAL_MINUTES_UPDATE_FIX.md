# Final Minutes Update Fix

## المشكلة
بعد الديبلوى على فيركل، كان تحديث الفاينل منتس يحدث لجميع الفيديوهات بما في ذلك فيديوهات الأسئلة (QV)، مما يسبب مشاكل في البيانات.

## الحل
تم تحديث الكود ليتحقق من نوع الفيديو قبل تحديث الفاينل منتس، بحيث يتم تحديث الفاينل منتس للفيديوهات الكاملة فقط وليس لفيديوهات الأسئلة.

## الملفات المحدثة

### 1. `pages/api/sheets/update-final-minutes.js`
- إضافة دالة `isQuestionVideo` محسنة للتعرف على فيديوهات الأسئلة
- التحقق من النصوص العربية (سؤال، أسئلة، اختبار، امتحان)
- التحقق من الكلمات الإنجليزية (Quiz, Test, Exam, HW, Homework)
- تخطي تحديث الفاينل منتس لفيديوهات الأسئلة

### 2. `pages/api/sheets/update-bunny-embeds.js`
- إضافة نفس دالة `isQuestionVideo` المحسنة
- التحقق من نوع الفيديو قبل تحديث الفاينل منتس
- إضافة معلومات `isQuestion` في النتائج

### 3. `server.js`
- تحديث دالة `isQuestionVideo` في API تحديث الفاينل منتس
- تحديث منطق التحقق في API تحديث الشيت
- إضافة رسائل توضيحية في الـ logs

### 4. `src/hooks/useSheetUpdater.ts`
- تحديث التعامل مع النتائج الجديدة
- إضافة رسائل توضيحية للفيديوهات التي تم تخطيها
- تحسين عرض الإحصائيات

## منطق التعرف على فيديوهات الأسئلة

### 1. نمط Q+رقم
```
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-الحصة-2-Q1.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-الحصة-3-Q2.mp4
```

### 2. النصوص العربية مع أرقام
```
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-سؤال-1.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-أسئلة-2.mp4
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-اختبار-1.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-امتحان-2.mp4
```

### 3. الكلمات الإنجليزية مع أرقام
```
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-Quiz-1.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-Test-2.mp4
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-HW-1.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-Homework-2.mp4
```

## أمثلة على الفيديوهات الكاملة (يتم تحديث الفاينل منتس)
```
M2-T2-U2-L2-SCI-AR-P0078-محمد-عبدالرحمن-الحصة-2.mp4
M2-T2-U2-L3-SCI-AR-P0078-محمد-عبدالرحمن-الحصة-3.mp4
M2-T2-U2-L4-SCI-AR-P0078-محمد-عبدالرحمن-الحصة-4.mp4
```

## رسائل الـ Logs

### عند تخطي فيديو سؤال:
```
[isQuestionVideo] Video "filename.mp4" has Q-number pattern - treating as question video
[API] ⚠️ SKIPPING final minutes update for question video: "filename.mp4"
```

### عند تحديث فيديو كامل:
```
[isQuestionVideo] Video "filename.mp4" is NOT a question video - will update final minutes
[API] ✅ Added final minutes update for row X: Y minutes (non-question video)
```

## اختبار المنطق
تم إنشاء ملف `test-final-minutes-update.js` لاختبار المنطق والتأكد من عمله بشكل صحيح.

## النتائج المتوقعة
- ✅ تحديث الفاينل منتس للفيديوهات الكاملة فقط
- ⚠️ تخطي تحديث الفاينل منتس لفيديوهات الأسئلة
- 📊 إحصائيات واضحة في النتائج
- 🔍 رسائل توضيحية في الـ logs

## التأكد من التحديث
بعد الديبلوى، تأكد من:
1. رفع فيديو كامل وملاحظة تحديث الفاينل منتس
2. رفع فيديو سؤال وملاحظة عدم تحديث الفاينل منتس
3. مراجعة الـ logs للتأكد من الرسائل التوضيحية 